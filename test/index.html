<!DOCTYPE html>
<html>
  <head>
    <title>Test</title>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <script type="text/javascript" src="../bower_components/es6-promise/promise.min.js"></script>
    <script type="text/javascript" src="../repos/asmcrypto.js/asmcrypto.js"></script>
    <script type="text/javascript" src="../dist/web-crypto.min.js"></script>
    <style>
      body {
       font-family: sans-serif, arial;
      }
      table {
        border-collapse: collapse;
      }
      th, td {
        padding: 8px;
        border: 1px solid #000;
      }
      .unsupported {
        background-color: #aaaaaa;
      }
      .result-sign {
        cursor: pointer;
        color: #fff;
        display: inline-block;
        width: 22px;
        height: 22px;
        border-radius: 50%;
        text-align: center;
        margin: 2px;
      }
      .result-sign.ok {
        background-color: green;
      }
      .result-sign.err {
        background-color: red;
      }
      .details {
        display: none;
        position: absolute;
        padding: 4px;
      }
      .details.ok {
        background-color: lightgreen;
        border: 1px solid green;
      }
      .details.err {
        background-color: pink;
        border: 1px solid red;
      }
      .result-sign:hover + .details {
        display: inline-block;
      }
    </style>
    <script>
      function findCell(alg, op) {
        return document.querySelector('#' + alg + ' .' + op);
      }
      
      function toString(ob, depth) {
        var rec = depth || 1;
        
        var ident = '';
        for(var i = 0; i < rec; i++) {
          ident = ident + '&nbsp;&nbsp;&nbsp;&nbsp';
        }
        
        var str = '';
        //str = str + ob.toString();
        str = str + ob;
        if(ob instanceof Object && Object.keys(ob)) {
          for(k in ob) {
              str = str + '<br />' + ident + k + ': ' + toString(ob[k], rec + 1);
          }
        }
        return str;
      }
      
      function manually(label, alg, op, fn) {
        var cell = findCell(alg, op);
        var a = document.createElement('a');
        a.innerHTML = label;
        a.href = '#';
        a.addEventListener('click', function(evt) {
          evt.preventDefault();
          evt.target.style.display = 'none';
          
          fn.call();
          
        }, false);
        cell.appendChild(a);
      }
      
      function ok(alg, op, shortmsg) {
        return function(result) {
          var cell = findCell(alg, op);

          // Sign
          var sign = document.createElement('span');
          sign.className =  "result-sign ok";
          sign.innerHTML = '&#10004';
          cell.appendChild(sign);

          // Details
          var details = document.createElement('div');
          details.className = "details ok";
          var resStr = toString(result);
          details.innerHTML = resStr;
          cell.appendChild(details);

          // Short message
          cell.appendChild(document.createTextNode(shortmsg));
          cell.appendChild(document.createElement('br'));
        };
      }
      
      function err(alg, op, shortmsg) {
        return function(error) {
          var cell = findCell(alg, op);

          // Sign
          var sign = document.createElement('span');
          sign.className =  "result-sign err";
          sign.innerHTML = '&#10006';
          cell.appendChild(sign);

          // Details
          var details = document.createElement('div');
          details.className = "details err";
          details.innerHTML = error;
          cell.appendChild(details);

          // Short message
          cell.appendChild(document.createTextNode(shortmsg));
          cell.appendChild(document.createElement('br'));
        };
      }
    </script>
  </head>
  <body>
    <table>
      <thead>
        <tr>
          <th>Algorithm name</th>
          <th>encrypt</th>
          <th>decrypt</th>
          <th>sign</th>
          <th>verify</th>
          <th>digest</th>
          <th>generateKey</th>
          <th>deriveKey</th>
          <th>deriveBits</th>
          <th>importKey</th>
          <th>exportKey</th>
          <th>wrapKey</th>
          <th>unwrapKey</th>
        </tr>
      </thead>
      <tbody>
        
        <!--
        #############################
        ###   RSASSA-PKCS1-v1_5   ###
        #############################
        -->
        <tr id="rsassa">
          <td class="algName">RSASSA-PKCS1-v1_5</td>
          <td class="encrypt unsupported"></td>
          <td class="decrypt unsupported"></td>
          <td class="sign unsupported"></td>
          <td class="verify"></td>
          <td class="digest"></td>
          <td class="generateKey"></td>
          <td class="deriveKey unsupported"></td>
          <td class="deriveBits unsupported"></td>
          <td class="importKey"></td>
          <td class="exportKey"></td>
          <td class="wrapKey unsupported"></td>
          <td class="unwrapKey unsupported"></td>              
        </tr>
        
        <!--
        ###################
        ###   RSA-PSS   ###
        ###################
        -->
        <tr id="rsa-pss">
          <td class="algName">RSA-PSS</td>
          <td class="encrypt unsupported unsupported"></td>
          <td class="decrypt"></td>
          <td class="sign"></td>
          <td class="verify"></td>
          <td class="digest unsupported"></td>
          <td class="generateKey"></td>
          <td class="deriveKey unsupported"></td>
          <td class="deriveBits unsupported"></td>
          <td class="importKey"></td>
          <td class="exportKey"></td>
          <td class="wrapKey unsupported"></td>
          <td class="unwrapKey unsupported"></td>              
        </tr>
        
        <!--
        ####################
        ###   RSA-OAEP   ###
        ####################
        -->
      <script>
        var rsaOaepAlg = {
          name: "RSA-OAEP",
          modulusLength: 1024,
          publicExponent: new Uint8Array([0x01, 0x00, 0x01]),
          hash: {name: 'SHA-256'}
        };
      </script>
        
        <tr id="rsa-oaep">
          <td class="algName">RSA-OAEP</td>
          <td class="encrypt">
            <script>
              webCrypto.subtle.generateKey(
                      rsaOaepAlg, false, ["encrypt", "decrypt"])
              .then(function(key){
                return webCrypto.subtle.encrypt(
                        {
                          name: 'RSA-OAEP',
                          hash: {name: 'SHA-256'}
                        }, 
                        key.publicKey, 
                        new Uint8Array([0,1,2,3,4]));
              })
              .then(ok("rsa-oaep", "encrypt", "Yes"))
              .catch(err("rsa-oaep", "encrypt", "No"));
            </script>
          </td>
          <td class="decrypt">
            <script>
              webCrypto.subtle.generateKey(
                      rsaOaepAlg, false, ["encrypt", "decrypt"])
              .then(function(key){
                
                webCrypto.subtle.encrypt(
                        {
                          name: 'RSA-OAEP',
                          hash: {name: 'SHA-256'}
                        }, 
                        key.publicKey, 
                        new Uint8Array([0,1,2,3,4]))
                .then(function(encrypted) {
                  return webCrypto.subtle.decrypt(
                          {
                            name: "RSA-OAEP",
                            hash: {name: 'SHA-256'}
                          }, 
                          key.privateKey, 
                          encrypted);
                })
                .then(ok("rsa-oaep", "decrypt", "Yes"))
                .catch(err("rsa-oaep", "decrypt", "No"));
              })
              .catch(err("rsa-oaep", "decrypt", "N/A"));
            </script>
          </td>
          <td class="sign unsupported"></td>
          <td class="verify unsupported"></td>
          <td class="digest unsupported"></td>
          <td class="generateKey">
            <script>
              manually('Run test (slow)', 'rsa-oaep', 'generateKey', function() {
                webCrypto.subtle.generateKey(
                  {
                    name: "RSA-OAEP",
                    modulusLength: 1024,
                    publicExponent: new Uint8Array([0x01, 0x00, 0x01]),
                    hash: {name: "SHA-256"}
                  },
                  false,
                  ["encrypt", "decrypt"]
                ).then(ok('rsa-oaep', 'generateKey', '1024 Bits'))
                .catch(err('rsa-oaep', 'generateKey', '1024 Bits'));

                webCrypto.subtle.generateKey(
                  {
                    name: "RSA-OAEP",
                    modulusLength: 2048,
                    publicExponent: new Uint8Array([0x01, 0x00, 0x01]),
                    hash: {name: "SHA-256"}
                  },
                  false,
                  ["encrypt", "decrypt"]
                ).then(ok('rsa-oaep', 'generateKey', '2048 Bits'))
                .catch(err('rsa-oaep', 'generateKey', '2048 Bits'));

                webCrypto.subtle.generateKey(
                  {
                    name: "RSA-OAEP",
                    modulusLength: 4096,
                    publicExponent: new Uint8Array([0x01, 0x00, 0x01]),
                    hash: {name: "SHA-256"}
                  },
                  false,
                  ["encrypt", "decrypt"]
                ).then(ok('rsa-oaep', 'generateKey', '4096 Bits'))
                .catch(err('rsa-oaep', 'generateKey', '4096 Bits'));
              });
            </script>
          </td>
          <td class="deriveKey unsupported"></td>
          <td class="deriveBits unsupported"></td>
          <td class="importKey">
            <script>
              
              // JWK public key
              webCrypto.subtle.importKey(
                "jwk", 
                {
                  kty: "RSA",
                  e: "AQAB",
                  n: "vGO3eU16ag9zRkJ4AK8ZUZrjbtp5xWK0LyFMNT8933evJoHeczexMUzSiXaLrEFSyQZortk81zJH3y41MBO_UFDO_X0crAquNrkjZDrf9Scc5-MdxlWU2Jl7Gc4Z18AC9aNibWVmXhgvHYkEoFdLCFG-2Sq-qIyW4KFkjan05IE",
                  alg: "RSA-OAEP-256",
                  ext: true,
                }, 
                rsaOaepAlg, false, ["encrypt"])
              .then(ok("rsa-oaep", "importKey", "jwk-pub"))
              .catch(err("rsa-oaep", "importKey", "jwk-pub"));
              
              // JWK private Key
              webCrypto.subtle.importKey(
                "jwk",
                {
                  kty: "RSA",
                  e: "AQAB",
                  d: "e-Nm1CB_F7j0p4Cb-T4WmFTh7RbxUthC3j8xnlXwHgWYwaPs9ZRkicgNCfmjEb-qJ-m0ho1Cz4WzlL1CtTKEdr2w0P6L_IQPvWkFYwUm0rpY9doxnOKkzq53dhP5zdc6N8aOLk4cmAcVjw4o_csc85H-0fxzQxsTP0_jhJn7SNE",
                  dp: "JuZmXNBY9uGGfx3w3ysmFumGBLooNjMwwgMduVS6T8S-0tZkBU-iwJPzXAkKhwINEv1EnygjwmJLBdoHROeEeQ",
                  dq: "KaKOFHxm9104WNwqTth04O9ogaDz_W0wkeHnxOxbWgdtFxsarnImiMlI3Hphv9JuHD5awzNAkaj9P7wDVew-5Q",
                  n: "x-Do39ky8RVFrFplFfAuOQGLr-rqY3h9OiNHVMe34LoVG4Aofps11ycyw5ka3Ls_yA-oRouGmaMjaiPUoaU_Lm5-CMSoVwyeANLZ4b2S7V-srXFS-Qpe6aD7NpzoUL9knwTnZFIGZlxSXB-NXL5kq18UuO1LQGe1To16ijXKNxc",
                  p: "4ss3ZAQMdmOk1BRQXwM9YHAoxVDkHDnSV9u89tUb3RbPXlV3fLlhRYtZ7u3FYaTzy08s8Ty2hV1KZ7xXhKEtuQ",
                  q: "4Z5ejmIJTwsgxN5pI6mLxwXqQwFDERYDnwU9_vyToWXMEPAphWpS9ET00YrdHsgIGao1Slc0jp4OUxaLfhtzTw",
                  qi: "R1aKNnhUiTjoCHfOVHZ6Qv5R7So-F5mtjDKCBvCi8190U3E25DiKRvDqHZ0bHMRbdQPLLknxHVnuETw6gddHUg",
                  alg: "RSA-OAEP-256",
                  ext: true,
                }, 
                rsaOaepAlg, false, ["decrypt"])
              .then(ok("rsa-oaep", "importKey", "jwk-priv"))
              .catch(err("rsa-oaep", "importKey", "jwk-priv"));
      
              // SPKI public key
              webCrypto.subtle.importKey(
                "spki", 
                new Uint8Array([
                  48,129,159,48,13,6,9,42,134,72,134,247,13,1,1,1,5,0,3,
                  129,141,0,48,129,137,2,129,129,0,182,93,35,213,252,204,
                  20,103,91,238,105,199,53,114,24,221,114,210,137,173,88,
                  76,205,113,148,148,79,80,59,208,60,75,231,248,78,125,12,
                  30,237,226,63,146,157,203,239,60,138,123,234,50,23,174,
                  216,33,122,16,53,246,140,254,75,246,205,204,117,204,115,
                  29,178,102,139,201,74,177,45,131,183,166,234,61,124,75,
                  110,3,70,202,148,95,45,228,94,95,148,2,162,79,146,137,29,
                  189,102,75,207,214,116,58,63,171,219,27,5,9,108,16,218,23,
                  169,43,181,119,31,172,95,205,180,18,255,203,2,3,1,0,1
                ]), 
                rsaOaepAlg, false, ["encrypt"])
              .then(ok("rsa-oaep", "importKey", "spki-pub"))
              .catch(err("rsa-oaep", "importKey", "spki-pub"));
      
              // PKCS8 private key
              webCrypto.subtle.importKey(
                "pkcs8", 
                new Uint8Array([
                  48,130,2,118,2,1,0,48,13,6,9,42,134,72,134,247,13,1,1,1,5,0,4,130,2,96,48,130,2,92,2,1,0,2,129,
                  129,0,217,78,147,218,221,152,10,66,75,127,242,108,182,142,157,44,93,58,176,193,135,103,216,179,
                  69,72,38,115,144,244,12,139,0,245,48,115,204,234,158,193,231,127,178,240,244,203,35,229,203,245,
                  110,215,199,19,98,183,164,223,159,203,128,123,173,26,12,172,250,99,254,35,225,221,39,51,62,3,139,
                  35,38,164,71,238,240,73,139,214,68,172,204,253,171,244,14,186,152,159,225,133,229,140,99,50,183,
                  242,217,248,86,233,20,117,42,136,55,8,65,124,244,65,29,15,194,255,78,31,189,146,105,161,2,3,1,0,1,
                  2,129,128,26,88,13,82,166,52,141,97,214,23,79,195,96,42,79,225,149,247,204,127,217,179,124,48,215,
                  128,84,177,3,236,162,44,163,212,21,168,164,57,249,63,22,154,131,141,244,143,63,237,214,217,13,51,
                  249,125,95,37,86,70,137,239,184,198,197,136,62,183,41,78,118,234,57,195,161,219,173,234,61,11,165,
                  109,209,9,3,22,186,114,32,135,147,74,6,106,190,214,36,208,32,220,61,12,41,105,251,247,18,159,3,198,
                  28,228,36,44,189,125,45,72,233,199,12,72,91,106,165,246,217,58,168,53,2,65,0,241,112,53,166,98,11,
                  38,73,58,156,84,190,118,74,247,229,85,178,83,231,53,137,237,228,246,12,32,206,157,198,152,70,11,185,
                  234,30,112,23,115,249,68,176,159,108,247,249,207,152,145,166,246,79,176,219,163,111,243,4,49,3,239,
                  242,63,147,2,65,0,230,105,200,1,208,201,237,225,85,27,39,216,193,1,253,168,88,15,242,166,70,106,235,
                  2,92,24,130,66,176,176,220,238,66,12,159,26,24,40,19,213,138,98,238,98,220,65,148,116,146,21,0,25,6,
                  177,57,216,70,51,149,244,157,153,106,123,2,64,127,92,254,48,67,80,54,102,50,240,253,19,108,59,168,1,
                  230,239,39,171,180,102,138,132,89,247,147,230,234,252,52,159,222,215,184,85,78,52,81,13,145,218,202,
                  127,37,97,54,205,249,39,230,143,171,112,114,11,64,91,89,176,6,7,248,217,2,65,0,220,94,95,132,29,4,
                  132,22,247,38,185,189,125,27,66,87,55,162,73,24,238,80,99,228,37,224,234,244,141,185,26,20,101,231,
                  92,99,192,166,212,17,112,1,158,173,190,170,154,41,195,109,130,98,109,28,35,142,205,213,152,158,19,
                  253,30,241,2,64,15,148,8,16,189,122,55,109,203,175,173,24,222,36,130,130,179,87,189,32,141,149,30,
                  115,211,227,79,234,78,202,253,48,173,95,167,203,20,193,160,30,146,33,109,4,221,25,212,216,183,100,
                  18,46,184,52,65,146,249,68,225,10,84,38,98,133
                ]), 
                rsaOaepAlg, false, ["decrypt"])
              .then(ok("rsa-oaep", "importKey", "pkcs8-priv"))
              .catch(err("rsa-oaep", "importKey", "pkcs8-priv"));
                
            </script>
          </td>
          <td class="exportKey">
            <script>
              webCrypto.subtle.generateKey(
                rsaOaepAlg, true, ["encrypt", "decrypt"]).then(function(key) {
                
                  // JWK public key
                  webCrypto.subtle.exportKey("jwk", key.publicKey)
                  .then(ok("rsa-oaep", "exportKey", "jwk-pub"))
                  .catch(err("rsa-oaep", "exportKey", "jwk-pub"));
                  
                  // JWK private key
                  webCrypto.subtle.exportKey("jwk", key.privateKey)
                  .then(ok("rsa-oaep", "exportKey", "jwk-priv"))
                  .catch(err("rsa-oaep", "exportKey", "jwk-priv"));
          
                  // SPKI public key
                  webCrypto.subtle.exportKey("spki", key.publicKey)
                  .then(ok("rsa-oaep", "exportKey", "spki-pub"))
                  .catch(err("rsa-oaep", "exportKey", "spki-pub"));
          
                  // PKCS8 private ley
                  webCrypto.subtle.exportKey("pkcs8", key.privateKey)
                  .then(ok("rsa-oaep", "exportKey", "pkcs8-priv"))
                  .catch(err("rsa-oaep", "exportKey", "pkcs8-priv"));    
    
                })
                .catch(err("rsa-oaep", "exportKey", "N/A"));
            </script>
          </td>
          <td class="wrapKey">
            <script>
              
              var wrappingKeyAlg = {
                name: "RSA-OAEP",
                modulusLength: 1024,
                publicExponent: new Uint8Array([0x01, 0x00, 0x01]),
                hash: {name: "SHA-256"}
              };
              
              webCrypto.subtle.generateKey(
                wrappingKeyAlg, 
                false, ["wrapKey", "unwrapKey"]).then(function(wrappingKey) {
                  
                  // AES-GCM
                  webCrypto.subtle.generateKey(
                    {
                      name: "AES-GCM",
                      length: 256
                    },
                    true, ["encrypt", "decrypt"]
                  )
                  .then(function(key) {
                    webCrypto.subtle.wrapKey(
                      "raw", key, wrappingKey.publicKey, wrappingKeyAlg)
                    .then(ok("rsa-oaep", "wrapKey", "AES-GCM (raw)"))
                    .catch(err("rsa-oaep", "wrapKey", "AES-GCM (raw)"));
                  })
                  .catch(err("rsa-oaep", "wrapKey", "AES-GCM (N/A)"));
                
                })
                .catch(err("rsa-oaep", "wrapKey", "N/A"));           
            </script>
          </td>
          <td class="unwrapKey">
            <script>
              
              var wrappingKeyAlg = {
                name: "RSA-OAEP",
                modulusLength: 1024,
                publicExponent: new Uint8Array([0x01, 0x00, 0x01]),
                hash: {name: "SHA-256"}
              };
              
              webCrypto.subtle.generateKey(
                wrappingKeyAlg, 
                false, ["wrapKey", "unwrapKey"]).then(function(wrappingKey) {
                  
                  // AES-GCM
                  webCrypto.subtle.generateKey(
                    {
                      name: "AES-GCM",
                      length: 256
                    },
                    true, ["encrypt", "decrypt"]
                  )
                  .then(function(key) {
                    return webCrypto.subtle.wrapKey(
                      "raw", key, wrappingKey.publicKey, wrappingKeyAlg)
                    .then(function(keyData) {
                      return webCrypto.subtle.unwrapKey(
                        'raw', 
                        keyData, 
                        wrappingKey.privateKey, 
                        wrappingKeyAlg,
                        {
                          name: "AES-GCM",
                          length: 256
                        },
                        false, ["encrypt", "decrypt"]);
                    })
                    .then(ok("rsa-oaep", "unwrapKey", "AES-GCM (raw)"))
                    .catch(err("rsa-oaep", "unwrapKey", "AES-GCM (raw)"));
                  })
                  .catch(err("rsa-oaep", "wrapKey", "AES-GCM (N/A)"));
                
                })
                .catch(err("rsa-oaep", "wrapKey", "N/A"));           
            </script>            
          </td>              
        </tr>
        
        <!--
        ################
        ###   ECDSA   ###
        ################
        -->
        <tr id="ecdsa">
          <td class="algName">ECDSA</td>
          <td class="encrypt unsupported"></td>
          <td class="decrypt unsupported"></td>
          <td class="sign"></td>
          <td class="verify"></td>
          <td class="digest unsupported"></td>
          <td class="generateKey"></td>
          <td class="deriveKey unsupported"></td>
          <td class="deriveBits unsupported"></td>
          <td class="importKey"></td>
          <td class="exportKey"></td>
          <td class="wrapKey unsupported"></td>
          <td class="unwrapKey unsupported"></td>              
        </tr>
        
        <!--
        ################
        ###   ECDH   ###
        ################
        -->
        <tr id="ecdh">
          <td class="algName">ECDH</td>
          <td class="encrypt unsupported"></td>
          <td class="decrypt unsupported"></td>
          <td class="sign unsupported"></td>
          <td class="verify unsupported"></td>
          <td class="digest unsupported"></td>
          <td class="generateKey"></td>
          <td class="deriveKey"></td>
          <td class="deriveBits"></td>
          <td class="importKey"></td>
          <td class="exportKey"></td>
          <td class="wrapKey"></td>
          <td class="unwrapKey"></td>              
        </tr>
        
        <!--
        ###################
        ###   AES-CTR   ###
        ###################
        -->
        <tr id="aes-ctr">
          <td class="algName">AES-CTR</td>
          <td class="encrypt"></td>
          <td class="decrypt"></td>
          <td class="sign unsupported"></td>
          <td class="verify unsupported"></td>
          <td class="digest unsupported"></td>
          <td class="generateKey"></td>
          <td class="deriveKey unsupported"></td>
          <td class="deriveBits unsupported"></td>
          <td class="importKey"></td>
          <td class="exportKey"></td>
          <td class="wrapKey"></td>
          <td class="unwrapKey"></td>              
        </tr>
        
        <!--
        ###################
        ###   AES-CBC   ###
        ###################
        -->
        <tr id="aes-cbc">
          <td class="algName">AES-CBC</td>
          <td class="encrypt"></td>
          <td class="decrypt"></td>
          <td class="sign unsupported"></td>
          <td class="verify unsupported"></td>
          <td class="digest unsupported"></td>
          <td class="generateKey"></td>
          <td class="deriveKey unsupported"></td>
          <td class="deriveBits unsupported"></td>
          <td class="importKey"></td>
          <td class="exportKey"></td>
          <td class="wrapKey"></td>
          <td class="unwrapKey"></td>              
        </tr>
        
        <!--
        #############################
        ###   AES-CMAC   ###
        #############################
        -->
        <tr id="aes-cmac">
          <td class="algName">AES-CMAC</td>
          <td class="encrypt unsupported"></td>
          <td class="decrypt unsupported"></td>
          <td class="sign"></td>
          <td class="verify"></td>
          <td class="digest unsupported"></td>
          <td class="generateKey"></td>
          <td class="deriveKey unsupported"></td>
          <td class="deriveBits unsupported"></td>
          <td class="importKey"></td>
          <td class="exportKey"></td>
          <td class="wrapKey unsupported"></td>
          <td class="unwrapKey unsupported"></td>              
        </tr>
        
        
        <!--
        ###################
        ###   AES-GCM   ###
        ###################
        -->
        <tr id="aes-gcm">
          <td class="algName">AES-GCM</td>
          <td class="encrypt">
            <script>
              webCrypto.subtle.generateKey(
                {
                  name: "AES-GCM",
                  length: 256
                }, 
                false, 
                ["encrypt"])
              .then(function(key){
                webCrypto.subtle.encrypt(
                  {
                    name: "AES-GCM",
                    iv: webCrypto.getRandomValues(new Uint8Array(12)),
                    tagLength: 128
                  }, 
                  key, 
                  new Uint8Array([0, 16, 32, 64]))
                .then(ok("aes-gcm", "encrypt", "Yes"))
                .catch(err("aes-gcm", "encrypt", "No"));
              })
              .catch(err("aes-gcm", "encrypt", "N/A"));           
            </script>
          </td>
          <td class="decrypt">
            <script>
              (function scope() {
                var key;
                var iv = webCrypto.getRandomValues(new Uint8Array(12));
                webCrypto.subtle.generateKey(
                  {
                    name: "AES-GCM",
                    length: 256
                  }, 
                  true, 
                  ["encrypt", "decrypt"])
                .then(function(k) {
                  key = k;
                  return webCrypto.subtle.encrypt(
                    {
                      name: "AES-GCM",
                      iv: iv,
                      tagLength: 128
                    }, 
                    key, 
                    new Uint8Array([0, 16, 32, 64]));
                })
                .then(function(encrypted) {
                  return webCrypto.subtle.decrypt(
                    {
                      name: "AES-GCM",
                      iv: iv,
                      tagLength: 128
                    },
                    key,
                    encrypted)
                  .then(ok("aes-gcm", "decrypt", "Yes"))
                  .catch(err("aes-gcm", "decrypt", "No"));
                })
                .catch(err("aes-gcm", "decrypt", "N/A"));
              })();
            </script>
          </td>
          <td class="sign unsupported"></td>
          <td class="verify unsupported"></td>
          <td class="digest unsupported"></td>
          <td class="generateKey">
            <script>
              webCrypto.subtle.generateKey(
                {
                  name: "AES-GCM",
                  length: 128
                },
                true,
                ['encrypt', 'decrypt']
              ).then(ok('aes-gcm', 'generateKey', '128 Bits'))
              .catch(err('aes-gcm', 'generateKey', '128 Bits'));
              
              webCrypto.subtle.generateKey(
                {
                  name: "AES-GCM",
                  length: 192
                },
                true,
                ['encrypt', 'decrypt']
              ).then(ok('aes-gcm', 'generateKey', '192 Bits'))
              .catch(err('aes-gcm', 'generateKey', '192 Bits'));
              
              webCrypto.subtle.generateKey(
                {
                  name: "AES-GCM",
                  length: 256
                },
                true,
                ['encrypt', 'decrypt']
              ).then(ok('aes-gcm', 'generateKey', '256 Bits'))
              .catch(err('aes-gcm', 'generateKey', '256 Bits'));
            </script>
          </td>
          <td class="deriveKey unsupported"></td>
          <td class="deriveBits unsupported"></td>
          <td class="importKey"></td>
          <td class="exportKey"></td>
          <td class="wrapKey">
            <script>
              
              var aesGcmAlg = {
                name: "AES-GCM",
                length: 256
              };
              
              webCrypto.subtle.generateKey(
                aesGcmAlg, 
                true, 
                ["wrapKey", "unwrapKey", "encrypt", "decrypt"]
              ).then(function(wrappingKey) {
                  
                  // AES-GCM
                  webCrypto.subtle.generateKey(
                    {
                      name: "AES-GCM",
                      length: 256
                    },
                    true, ["encrypt", "decrypt"]
                  )
                  .then(function(key) {
                    webCrypto.subtle.wrapKey(
                      "raw", 
                      key, 
                      wrappingKey, 
                      {
                        name: "AES-GCM",
                        iv: new Uint8Array(12)
                      })
                    .then(ok("aes-gcm", "wrapKey", "AES-GCM (raw)"))
                    .catch(err("aes-gcm", "wrapKey", "AES-GCM (raw)"));
                  })
                  .catch(err("aes-gcm", "wrapKey", "AES-GCM (N/A)"));
                
                })
                .catch(err("aes-gcm", "wrapKey", "N/A"));           
            </script>            
          </td>
          <td class="unwrapKey">
            <script>
              
              var aesGcmAlg = {
                name: "AES-GCM",
                length: 256
              };
              
              webCrypto.subtle.generateKey(
                aesGcmAlg, 
                true, 
                ["wrapKey", "unwrapKey", "encrypt", "decrypt"]
              ).then(function(wrappingKey) {
                  
                  // AES-GCM
                  webCrypto.subtle.generateKey(
                    {
                      name: "AES-GCM",
                      length: 256
                    },
                    true, 
                    ["encrypt", "decrypt"]
                  )
                  .then(function(key) {
                    return webCrypto.subtle.wrapKey(
                      "raw", 
                      key, 
                      wrappingKey, 
                      {
                        name: 'AES-GCM',
                        iv: new Uint8Array(12)
                      })
                    .then(function(keyData) {
                      return webCrypto.subtle.unwrapKey(
                        'raw', 
                        keyData, 
                        wrappingKey, 
                        {
                          name: "AES-GCM",
                          iv: new Uint8Array(12)
                        },
                        {
                          name: "AES-GCM",
                          length: 256
                        },
                        true, 
                        ["encrypt", "decrypt"]);
                    })
                    .then(ok("aes-gcm", "unwrapKey", "AES-GCM (raw)"))
                    .catch(err("aes-gcm", "unwrapKey", "AES-GCM (raw)"));
                  })
                  .catch(err("aes-gcm", "wrapKey", "AES-GCM (N/A)"));
                
                })
                .catch(err("aes-gcm", "wrapKey", "N/A"));           
            </script>              
          </td>              
        </tr>
        
        <!--
        ###################
        ###   AES-CFB   ###
        ###################
        -->
        <tr id="aes-cfb">
          <td class="algName">AES-CFB</td>
          <td class="encrypt"></td>
          <td class="decrypt"></td>
          <td class="sign unsupported"></td>
          <td class="verify unsupported"></td>
          <td class="digest unsupported"></td>
          <td class="generateKey"></td>
          <td class="deriveKey unsupported"></td>
          <td class="deriveBits unsupported"></td>
          <td class="importKey"></td>
          <td class="exportKey"></td>
          <td class="wrapKey"></td>
          <td class="unwrapKey"></td>              
        </tr>
        
        <!--
        #############################
        ###   AES-KW   ###
        #############################
        -->
        <tr id="aes-kw">
          <td class="algName">AES-KW</td>
          <td class="encrypt unsupported"></td>
          <td class="decrypt unsupported"></td>
          <td class="sign unsupported"></td>
          <td class="verify unsupported"></td>
          <td class="digest unsupported"></td>
          <td class="generateKey"></td>
          <td class="deriveKey unsupported"></td>
          <td class="deriveBits unsupported"></td>
          <td class="importKey"></td>
          <td class="exportKey"></td>
          <td class="wrapKey"></td>
          <td class="unwrapKey"></td>              
        </tr>
        
        <!--
        ################
        ###   HMAC   ###
        ################
        -->
        <tr id="hmac">
          <td class="algName">HMAC</td>
          <td class="encrypt unsupported"></td>
          <td class="decrypt unsupported"></td>
          <td class="sign"></td>
          <td class="verify"></td>
          <td class="digest unsupported"></td>
          <td class="generateKey"></td>
          <td class="deriveKey unsupported"></td>
          <td class="deriveBits unsupported"></td>
          <td class="importKey"></td>
          <td class="exportKey"></td>
          <td class="wrapKey unsupported"></td>
          <td class="unwrapKey unsupported"></td>              
        </tr>
        
        <!--
        ##############
        ###   DH   ###
        ##############
        -->
        <tr id="dh">
          <td class="algName">DH</td>
          <td class="encrypt unsupported"></td>
          <td class="decrypt unsupported"></td>
          <td class="sign unsupported"></td>
          <td class="verify unsupported"></td>
          <td class="digest unsupported"></td>
          <td class="generateKey"></td>
          <td class="deriveKey"></td>
          <td class="deriveBits"></td>
          <td class="importKey"></td>
          <td class="exportKey"></td>
          <td class="wrapKey unsupported"></td>
          <td class="unwrapKey unsupported"></td>              
        </tr>
        
        <!--
        ################
        ###   SHA1   ###
        ################
        -->
        <tr id="sha-1">
          <td class="algName">SHA1</td>
          <td class="encrypt unsupported"></td>
          <td class="decrypt unsupported"></td>
          <td class="sign unsupported"></td>
          <td class="verify unsupported"></td>
          <td class="digest">
            <script>
              webCrypto.subtle.digest(
                {name: 'SHA-1'},
                new Uint8Array([1,2,3,4]))
              .then(ok('sha-1', 'digest', 'Yes'))
              .catch(err('sha-1', 'digest', 'No'));
            </script>
          </td>
          <td class="generateKey unsupported"></td>
          <td class="deriveKey unsupported"></td>
          <td class="deriveBits unsupported"></td>
          <td class="importKey unsupported"></td>
          <td class="exportKey unsupported"></td>
          <td class="wrapKey unsupported"></td>
          <td class="unwrapKey unsupported"></td>              
        </tr>
        
        <!--
        ###################
        ###   SHA-256   ###
        ###################
        -->
        <tr id="sha-256">
          <td class="algName">SHA-256</td>
          <td class="encrypt unsupported"></td>
          <td class="decrypt unsupported"></td>
          <td class="sign unsupported"></td>
          <td class="verify unsupported"></td>
          <td class="digest">
            <script>
              webCrypto.subtle.digest(
                {name: 'SHA-256'},
                new Uint8Array([1,2,3,4]))
              .then(ok('sha-256', 'digest', 'Yes'))
              .catch(err('sha-256', 'digest', 'No'));
            </script>
          </td>
          <td class="generateKey unsupported"></td>
          <td class="deriveKey unsupported"></td>
          <td class="deriveBits unsupported"></td>
          <td class="importKey unsupported"></td>
          <td class="exportKey unsupported"></td>
          <td class="wrapKey unsupported"></td>
          <td class="unwrapKey unsupported"></td>              
        </tr>
        
        <!--
        ###################
        ###   SHA-384   ###
        ###################
        -->
        <tr id="sha-384">
          <td class="algName">SHA-384</td>
          <td class="encrypt unsupported"></td>
          <td class="decrypt unsupported"></td>
          <td class="sign unsupported"></td>
          <td class="verify unsupported"></td>
          <td class="digest">
            <script>
              webCrypto.subtle.digest(
                {name: 'SHA-384'},
                new Uint8Array([1,2,3,4]))
              .then(ok('sha-384', 'digest', 'Yes'))
              .catch(err('sha-384', 'digest', 'No'));
            </script>
          </td>
          <td class="generateKey unsupported"></td>
          <td class="deriveKey unsupported"></td>
          <td class="deriveBits unsupported"></td>
          <td class="importKey unsupported"></td>
          <td class="exportKey unsupported"></td>
          <td class="wrapKey unsupported"></td>
          <td class="unwrapKey unsupported"></td>              
        </tr>
        
        <!--
        ###################
        ###   SHA-512   ###
        ###################
        -->
        <tr id="sha-512">
          <td class="algName">SHA-512</td>
          <td class="encrypt unsupported"></td>
          <td class="decrypt unsupported"></td>
          <td class="sign unsupported"></td>
          <td class="verify unsupported"></td>
          <td class="digest">
            <script>
              webCrypto.subtle.digest(
                {name: 'SHA-512'},
                new Uint8Array([1,2,3,4]))
              .then(ok('sha-512', 'digest', 'Yes'))
              .catch(err('sha-512', 'digest', 'No'));
            </script>
          </td>
          <td class="generateKey unsupported"></td>
          <td class="deriveKey unsupported"></td>
          <td class="deriveBits unsupported"></td>
          <td class="importKey unsupported"></td>
          <td class="exportKey unsupported"></td>
          <td class="wrapKey unsupported"></td>
          <td class="unwrapKey unsupported"></td>              
        </tr>
        
        <!--
        #################
        ###   CONCAT  ###
        #################
        -->
        <tr id="concat">
          <td class="algName">CONCAT</td>
          <td class="encrypt unsupported"></td>
          <td class="decrypt unsupported"></td>
          <td class="sign unsupported"></td>
          <td class="verify unsupported"></td>
          <td class="digest unsupported"></td>
          <td class="generateKey unsupported"></td>
          <td class="deriveKey"></td>
          <td class="deriveBits"></td>
          <td class="importKey"></td>
          <td class="exportKey unsupported"></td>
          <td class="wrapKey unsupported"></td>
          <td class="unwrapKey unsupported"></td>              
        </tr>
        
        <!--
        ####################
        ###   HKDF-CTR   ###
        ####################
        -->
        <tr id="hkdf-ctr">
          <td class="algName">HKDF-CTR</td>
          <td class="encrypt unsupported"></td>
          <td class="decrypt unsupported"></td>
          <td class="sign unsupported"></td>
          <td class="verify unsupported"></td>
          <td class="digest unsupported"></td>
          <td class="generateKey unsupported"></td>
          <td class="deriveKey"></td>
          <td class="deriveBits"></td>
          <td class="importKey"></td>
          <td class="exportKey unsupported"></td>
          <td class="wrapKey unsupported"></td>
          <td class="unwrapKey unsupported"></td>              
        </tr>
        
        <!--
        ##################
        ###   PBKDF2   ###
        ##################
        -->
        <tr id="pbkdf2">
          <td class="algName">PBKDF2</td>
          <td class="encrypt unsupported"></td>
          <td class="decrypt unsupported"></td>
          <td class="sign unsupported"></td>
          <td class="verify unsupported"></td>
          <td class="digest unsupported"></td>
          <td class="generateKey">
            <script>
              manually('Run test (prompt)', 'pbkdf2', 'generateKey', function() {
                webCrypto.subtle.generateKey(
                    {name: 'PBKDF2'},
                    false,
                    ["deriveKey", "deriveBits"])
                .then(ok('pbkdf2', 'generateKey', 'Yes'))
                .catch(err('pbkdf2', 'generateKey', 'No'));
              });
            </script>
          </td>
          <td class="deriveKey">
            <script>
              
              webCrypto.subtle.importKey(
                  "raw",
                  webCrypto.getRandomValues(new Uint8Array(16)),
                  {name: "PBKDF2"},
                  true,
                  ["deriveKey", "deriveBits"])
              .then(function(key) {
                var alg = {
                  name: 'AES-GCM',
                  length: 256
                };
                
                // SHA-1
                webCrypto.subtle.deriveKey(
                  {
                    name: "PBKDF2",
                    salt: webCrypto.getRandomValues(new Uint8Array(16)),
                    iterations: 1000,
                    hash: {name: "SHA-1"}
                  }, key, alg, false, ["encrypt", "decrypt"])
                .then(ok("pbkdf2", "deriveKey", "SHA-1"))
                .catch(err("pbkdf2", "deriveKey", "SHA-1"));
        
                // SHA-256
                webCrypto.subtle.deriveKey(
                  {
                    name: "PBKDF2",
                    salt: webCrypto.getRandomValues(new Uint8Array(16)),
                    iterations: 1000,
                    hash: {name: "SHA-256"}
                  }, key, alg, false, ["encrypt", "decrypt"])
                .then(ok("pbkdf2", "deriveKey", "SHA-256"))
                .catch(err("pbkdf2", "deriveKey", "SHA-256"));
                
                // SHA-384
                webCrypto.subtle.deriveKey(
                  {
                    name: "PBKDF2",
                    salt: webCrypto.getRandomValues(new Uint8Array(16)),
                    iterations: 1000,
                    hash: {name: "SHA-384"}
                  }, key, alg, false, ["encrypt", "decrypt"])
                .then(ok("pbkdf2", "deriveKey", "SHA-384"))
                .catch(err("pbkdf2", "deriveKey", "SHA-384"));
        
                // SHA-512
                webCrypto.subtle.deriveKey(
                  {
                    name: "PBKDF2",
                    salt: webCrypto.getRandomValues(new Uint8Array(16)),
                    iterations: 1000,
                    hash: {name: "SHA-512"}
                  }, key, alg, false, ["encrypt", "decrypt"])
                .then(ok("pbkdf2", "deriveKey", "SHA-512"))
                .catch(err("pbkdf2", "deriveKey", "SHA-512"));
              })
              .catch(err('pbkdf2', 'deriveKey', 'N/A'));
            </script>
          </td>
          <td class="deriveBits">
            <script>
              webCrypto.subtle.importKey(
                  "raw",
                  webCrypto.getRandomValues(new Uint8Array(16)),
                  {name: "PBKDF2"},
                  true,
                  ["deriveKey", "deriveBits"])
              .then(function(key) {
                
                // SHA-1
                webCrypto.subtle.deriveBits(
                  {
                    "name": "PBKDF2",
                    salt: webCrypto.getRandomValues(new Uint8Array(16)),
                    iterations: 1000,
                    hash: {name: "SHA-1"}
                  }, key, 128)
                .then(ok("pbkdf2", "deriveBits", "SHA-1"))
                .catch(err("pbkdf2", "deriveBits", "SHA-1"));
       
       
                // SHA-256
                webCrypto.subtle.deriveBits(
                  {
                    "name": "PBKDF2",
                    salt: webCrypto.getRandomValues(new Uint8Array(16)),
                    iterations: 1000,
                    hash: {name: "SHA-256"}
                  }, key, 128)
                .then(ok("pbkdf2", "deriveBits", "SHA-256"))
                .catch(err("pbkdf2", "deriveBits", "SHA-256"));
                
                // SHA-384
                webCrypto.subtle.deriveBits(
                  {
                    "name": "PBKDF2",
                    salt: webCrypto.getRandomValues(new Uint8Array(16)),
                    iterations: 1000,
                    hash: {name: "SHA-384"}
                  }, key, 128)
                .then(ok("pbkdf2", "deriveBits", "SHA-384"))
                .catch(err("pbkdf2", "deriveBits", "SHA-384"));
        
                // SHA-512
                webCrypto.subtle.deriveBits(
                  {
                    "name": "PBKDF2",
                    salt: webCrypto.getRandomValues(new Uint8Array(16)),
                    iterations: 1000,
                    hash: {name: "SHA-512"}
                  }, key, 128)
                .then(ok("pbkdf2", "deriveBits", "SHA-512"))
                .catch(err("pbkdf2", "deriveBits", "SHA-512"));
        
              })
              .catch(err('pbkdf2', 'deriveBits', 'N/A'));
            </script>
          </td>
          <td class="importKey">
            <script>
              webCrypto.subtle.importKey(
                  "raw",
                  webCrypto.getRandomValues(new Uint8Array(16)),
                  {name: "PBKDF2"},
                  true,
                  ["deriveKey", "deriveBits"])
              .then(ok('pbkdf2', 'importKey', 'Yes'))
              .catch(err('pbkdf2', 'importKey', 'No'));
            </script>
          </td>
          <td class="exportKey unsupported"></td>
          <td class="wrapKey unsupported"></td>
          <td class="unwrapKey unsupported"></td>              
        </tr>
        
      </tbody>
    </table>
    <script>
    </script>
  </body>
</html>
